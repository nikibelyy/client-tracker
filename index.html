<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Клиенты</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0d1117">
<link rel="apple-touch-icon" href="icon.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Клиенты">

<style>
  :root {
    --bg: #0d1117; --card: #161b22; --accent: #3b82f6;
    --text: #f0f6fc; --muted: #8b949e; --danger: #ef4444;
    --radius: 12px;
    font-family: -apple-system, BlinkMacSystemFont, "Inter", "Roboto", sans-serif;
  }
  *{box-sizing:border-box;}
  body{margin:0;background:var(--bg);color:var(--text);}
  .wrap{max-width:700px;margin:0 auto;padding:16px;}
  h1{text-align:center;margin:0 0 12px;font-size:1.2rem;}
  .card{background:var(--card);border-radius:var(--radius);padding:16px;margin-bottom:16px;}
  form .row{display:flex;gap:10px;margin-bottom:12px;}
  @media(max-width:600px){form .row{flex-direction:column;}}
  label{display:block;margin-bottom:6px;font-size:0.85rem;color:var(--muted);}
  input,select{width:100%;padding:10px;border-radius:var(--radius);border:none;background:#0b0f15;color:var(--text);}
  .btn{padding:10px 14px;border:none;border-radius:var(--radius);font-weight:600;cursor:pointer;}
  .primary{background:var(--accent);color:white;}
  .ghost{background:transparent;border:1px solid #30363d;color:var(--muted);}
  .danger{background:var(--danger);color:white;}
  .list{display:flex;flex-direction:column;gap:10px;}
  .client{display:flex;justify-content:space-between;align-items:center;padding:12px;background:var(--card);border-radius:var(--radius);}
  .info{flex:1;overflow:hidden;}
  .name{font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
  .details{font-size:0.85rem;color:var(--muted);margin-top:4px;}
  .actions{display:flex;gap:6px;flex-shrink:0;align-items:center;}
  .badge{padding:6px 10px;background:#1f2937;border-radius:999px;font-weight:600;font-size:0.9rem;color:var(--accent);}
  .status{padding:6px 10px;border-radius:999px;font-weight:600;font-size:0.85rem;text-transform:capitalize;}
  .status.active{background:#065f46;color:#a7f3d0;}
  .status.pending{background:#92400e;color:#fcd34d;}
  .status.done{background:#1e3a8a;color:#93c5fd;}
  .empty{text-align:center;padding:20px;color:var(--muted);}
</style>
</head>
<body>
<div class="wrap">
  <h1>Клиенты</h1>

  <div class="card">
    <form id="clientForm">
      <div class="row">
        <div style="flex:1">
          <label for="fio">ФИО</label>
          <input id="fio" required>
        </div>
      </div>
      <div class="row">
        <div style="flex:1">
          <label for="brand">Марка</label>
          <input id="brand">
        </div>
        <div style="width:140px">
          <label for="plate">Номер</label>
          <input id="plate">
        </div>
      </div>
      <div class="row">
        <div style="flex:1">
          <label for="percent">Процент</label>
          <select id="percent">
            <option value="30">30%</option>
            <option value="25">25%</option>
            <option value="20">20%</option>
            <option value="15">15%</option>
          </select>
        </div>
        <div style="flex:1">
          <label for="status">Статус</label>
          <select id="status">
            <option value="active">Активный</option>
            <option value="pending">В ожидании</option>
            <option value="done">Завершён</option>
          </select>
        </div>
      </div>
      <div class="row" style="margin-top:6px">
        <button type="submit" class="btn primary" id="saveBtn">Добавить</button>
        <button type="button" class="btn ghost" id="cancelEdit" style="display:none">Отменить</button>
      </div>
    </form>
  </div>

  <div class="list" id="clientsList">
    <div class="empty" id="emptyState">Нет клиентов</div>
  </div>
</div>

<script>
(function(){
  const STORAGE_KEY = 'clients_data_v3';
  const form=document.getElementById('clientForm');
  const fioIn=document.getElementById('fio');
  const brandIn=document.getElementById('brand');
  const plateIn=document.getElementById('plate');
  const percentIn=document.getElementById('percent');
  const statusIn=document.getElementById('status');
  const clientsList=document.getElementById('clientsList');
  const emptyState=document.getElementById('emptyState');
  const saveBtn=document.getElementById('saveBtn');
  const cancelEdit=document.getElementById('cancelEdit');
  let clients=[]; let editId=null;

  function uid(){return Date.now().toString(36)+Math.random().toString(36).substr(2,5);}
  function save(){localStorage.setItem(STORAGE_KEY,JSON.stringify(clients));}
  function load(){clients=JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]');render();}

  function render(){
    clientsList.innerHTML='';
    if(!clients.length){clientsList.appendChild(emptyState);return;}
    clients.forEach(c=>{
      const row=document.createElement('div');row.className='client';
      const info=document.createElement('div');info.className='info';
      const name=document.createElement('div');name.className='name';name.textContent=c.fio;
      const details=document.createElement('div');details.className='details';details.textContent=(c.brand||'—')+' · '+(c.plate||'—');
      info.appendChild(name);info.appendChild(details);

      const actions=document.createElement('div');actions.className='actions';
      const badge=document.createElement('div');badge.className='badge';badge.textContent=c.percent+'%';
      const status=document.createElement('div');status.className='status '+c.status;
      if(c.status==='active') status.textContent='Активный';
      if(c.status==='pending') status.textContent='В ожидании';
      if(c.status==='done') status.textContent='Завершён';

      const editBtn=document.createElement('button');editBtn.className='btn ghost';editBtn.textContent='✎';editBtn.onclick=()=>startEdit(c.id);
      const delBtn=document.createElement('button');delBtn.className='btn danger';delBtn.textContent='×';delBtn.onclick=()=>remove(c.id);

      actions.appendChild(badge);
      actions.appendChild(status);
      actions.appendChild(editBtn);
      actions.appendChild(delBtn);

      row.appendChild(info);row.appendChild(actions);
      clientsList.appendChild(row);
    });
  }

  form.onsubmit=e=>{
    e.preventDefault();
    const fio=fioIn.value.trim(); if(!fio) return;
    const obj={id:editId||uid(),fio,brand:brandIn.value.trim(),plate:plateIn.value.trim(),percent:percentIn.value,status:statusIn.value};
    if(editId){const i=clients.findIndex(x=>x.id===editId);if(i>=0)clients[i]=obj;editId=null;saveBtn.textContent='Добавить';cancelEdit.style.display='none';}
    else{clients.unshift(obj);}
    save();render();form.reset();percentIn.value='30';statusIn.value='active';
  };
  function startEdit(id){
    const c=clients.find(x=>x.id===id);if(!c)return;
    editId=id;
    fioIn.value=c.fio;brandIn.value=c.brand;plateIn.value=c.plate;percentIn.value=c.percent;statusIn.value=c.status||'active';
    saveBtn.textContent='Сохранить';cancelEdit.style.display='';
  }
  cancelEdit.onclick=()=>{editId=null;form.reset();percentIn.value='30';statusIn.value='active';saveBtn.textContent='Добавить';cancelEdit.style.display='none';};
  function remove(id){clients=clients.filter(c=>c.id!==id);save();render();}
  load();

  if('serviceWorker' in navigator){navigator.serviceWorker.register('sw.js');}
})();
</script>
</body>
</html>
